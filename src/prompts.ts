import { Location } from "./types";

// 道幅分析用プロンプトを生成
export function createRoadWidthAnalysisPrompt(location: Location): string {
  return `あなたは、日本の道路の **Google Street View 画像** を分析して、**車線幅** と **道路の特徴** を推定します。このデータは、日本全国の **走行可能な峠道（狭すぎて安全に通れない道を除外する）** を特定するプログラムで使用されます。道路幅のオープンデータが十分に公開されていないため、あなたの推定結果が「狭すぎる道路」をフィルタする助けになります。

あなたのタスクは、この道路画像を注意深く観察し、次の特徴を推定することです：

1. **車線数 (Number of lanes)**: 画像内で確認できる車線の総数を数える
2. **センターラインが存在する (Center line exists)**: 道路にセンターライン（中央線）があるかを判定する（はい/いいえ）
3. **進行方向に路肩が存在する (Road shoulder exists in direction of travel)**: 進行方向側の路肩があるか確認し、ある場合は幅（m）を推定する
4. **進行方向と逆側に路肩が存在する (Road shoulder exists on opposite side)**: 反対側の路肩があるか確認し、ある場合は幅（m）を推定する
5. **進行方向にガードレールが存在する (Guardrail exists in direction of travel)**: 進行方向側にガードレールがあるか判定する（はい/いいえ）
6. **進行方向と逆側にガードレールが存在する (Guardrail exists on opposite side)**: 反対側にガードレールがあるか判定する（はい/いいえ）
7. **車線内の横幅 (Lane width)**: 1車線あたりの幅（m）を推定する

**分析の進め方（推定精度を上げるための基準物の比較）**

画像内に写っている次のような「基準になりそうな物体」を使ってスケール（距離感）を作り、寸法を推定してください：

- ガードレール（日本の一般的なガードレールの幅は **約0.3〜0.4m**）
- 道路標識・支柱（標識柱の直径は一般に **60〜90mm** 程度）
- 路面標示（区画線の一般的な幅は **15cm**）
- 車両（写っている場合。一般的な乗用車の幅は **約1.7m**）
- 電柱（直径は通常 **15〜20cm** 程度）

最終回答の前に、スクラッチパッドで **段階的に推論** してください。

<scratchpad>
スクラッチパッドでは次を行うこと：
1. 画像内で基準に使えそうな物体を特定する  
2. その物体を使ってスケール感（距離・幅の基準）を推定する  
3. 指定された特徴を1つずつ体系的に分析する  
4. 幅の推定に至った根拠（比較対象と計算・見積もり）を示す  
5. 不確実性や仮定（見えづらい、角度の歪み等）を明記する  
</scratchpad>

分析後、次の形式で推定結果を出力してください：

<analysis>
車線数: [number]
センターラインが存在する: [はい/いいえ]
進行方向に路肩が存在する: [はい/いいえ]
進行方向の路肩幅: [X.Xメートル or 該当なし]
進行方向と逆側に路肩が存在する: [はい/いいえ]
進行方向と逆側の路肩幅: [X.Xメートル or 該当なし]
進行方向にガードレールが存在する: [はい/いいえ]
進行方向と逆側にガードレールが存在する: [はい/いいえ]
車線内の横幅: [X.Xメートル]
</analysis>

測定値はメートル単位で **小数1桁** にしてください（例：3.0、0.5）。

特徴が存在しない、または判定できない場合、幅の項目は **「該当なし」** としてください。`;
}
